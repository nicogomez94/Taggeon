<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@latest/dist/css/splide.min.css">

<div class="overlay-prod"></div>
<div class="row">
   <div class="container col-lg-8 col-md-12 col-sm-12 col-12" id="contenedor-form-subir" >
      <h1>Editar Publicacion</h1>
      <hr>
      <form id="editar-publicacion-form">
         <input type="hidden" name="accion" value="editar">
         <div id="col-foto-upload">
            <!-- <p class="label-descr">Seleccione al menos una foto para el publicacion.</p> -->
            <div class="row">
               <div id="img-subir-pins" class="img-subir">
                  <div id="mensaje-flotante-imgsp">
                     <div><i style="font-size: 2em" class="fas fa-file-upload"></i></div>
                     <div>Arrastra una imagen, o haz click para subir</div>
                  </div>
                  <input type="file" name="publicacion_foto" id="imagen-pins" onchange="cargarImgPines(event)">
               </div>
               <div id="output-container">
                  <div id="eliminar-img-flotante">
                     <i class="fas fa-trash-alt"></i>
                  </div>
                  <!--  -->
                  <div class="popup-prod-overlay">
                     <div class="popup-prod-cont">
                        <div class="salir-popup"><a href="#"><i class="fas fa-times"></i></a></div>
                        <!-- <h6>Elija un producto:</h6> -->
                        <div class="filtros">
                              <span>
                                 <input id="buscador-titulo-input" class="busq-prod-subir-public" type="text" name="prod_search_seller" placeholder="Busque el producto en la lista">
                                 <i class="fas fa-times-circle limpiar-buscador" style="display: none;"></i>
                              </span>
                              <br>
                              <!-- <a id="buscador-titulo" class="btn"><i class="fas fa-search"></i></a> -->
                        </div>
                        <div class="popup-producto">
                           <div class="splide">
                              <div class="splide__track">
                                 <ul class="splide__list"></ul>
                              </div>
                           </div>
                        </div>
                        <!-- <div class="popup-prod-cont-galeria"></div> -->
                        <!-- <select class="lista-prod"></select> -->
                     </div>
                  </div>
                  <div class="click-protector-cont"></div>
                  <!--  -->
                  <div id="map">
                     <img class="img-pines-amapear" src="">
                  </div>
                  <!--  -->
                  
               </div>
            </div>
            <div class="anadir-productos">
               <hr>
               <a href="#" id="anadir-productos-btn" class="btn btn-warning">AÃ±adir/Editar productos</a>
               <a href="#" id="terminar-productos-btn" class="btn btn-warning">Terminar Edicion</a>
               <!-- <a href="#" id="limpiar-productos-btn" class="btn btn-warning">Limpiar Pines</a> -->
            </div>
            <div class="row">
               <div class="col-lg-12">
                  <div class="group">      
                     <input type="text" name="publicacion_nombre" id="titulo-publicacion" required>
                     <span class="highlight"></span>
                     <span class="bar"></span>
                     <label class="label-text-subir-publicacion">Nombre del publicacion</label>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="col-lg-12">
                  <p class="label-descr">Descripcion de la publicacion</p>
                  <textarea type="text" name="publicacion_descripcion" id="descr-publicacion" required></textarea>
               </div>
            </div>
            <div class="row">
               <div class="col-lg-3">
                  <p class="label-descr">Categor&iacute;a de la publicacion</p>
                  <select name="publicacion_categoria" id="publicacion_categoria">
                     <option value="" selected disabled hidden required>Elija una categoria</option>
                     <option value="14">Herramientas y Construcci&oacute;n</option>
                  </select>
               </div>
            </div>
            <br><hr>
            
         <div>
            <div class="row">
               <div class="col-lg-4">
                  <br>
                  <input type="submit" class="btn btn-warning" value="Guardar publicacion">
               </div>
            </div>
         </div>
      </div>
      </form>
   </div>
</div>

   <script>
      var jsonData = {json};
   </script>
   


   <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
   <script src="js/jquery-3.5.1.js"></script>
   <script src="bootstrap-4.5.2-dist/js/bootstrap.min.js"></script>
   <!-- <script src="js/popper.js"></script> -->
   <script src="js/func.js?time=270421-1758"></script>
   <!-- script para la seleccion de fotos -->
   <script src="https://cdn.jsdelivr.net/npm/@splidejs/splide@latest/dist/js/splide.min.js"></script>
   <!--  -->
      <link rel="stylesheet" href="../../plugins/dropPin-master/dropPin/dropPin.css" type="text/css" />
      <script type="text/javascript" src="../../plugins/dropPin-master/dropPin/dropPin.js?time=270421-1758"></script>
      <script>
         $(document).ready(function(){
            
            //CATEGORIA
            var catPublicSize = jsonData.categoria.length;

            if(catPublicSize>0){
               for(var i=0; i<catPublicSize; i++){

                  var nombre_categoria_public = jsonData.categoria[i].nombre;
                  var id_categoria_public = jsonData.categoria[i].id;
                  
                  var cat_html = '<option value="'+id_categoria_public+'">'+nombre_categoria_public+'</option>'

                  $("#publicacion_categoria").append(cat_html);

               }
            }

            var sizePublic = jsonData.publicaciones.length;
               if(sizePublic>0){
                  for(var i=0; i<sizePublic; i++){
                     var id_public = jsonData.publicaciones[i].id;
                     var id_public_cat = jsonData.publicaciones[i].id_publicacion_categoria;
                     var nombre_public = jsonData.publicaciones[i].publicacion_nombre;
                     var descr_public = jsonData.publicaciones[i].publicacion_descripcion;
                     var imagen_id = jsonData.publicaciones[i].foto;
                     var foto_src = '/publicaciones_img/'+imagen_id+'.png';
                     var tags = jsonData.publicaciones[i].pid;

                     ///SHOW PINES
                     var producto_parse = JSON.parse(tags);
                     var producto_parse_size = producto_parse.length;
  
                     var test = {"markers":producto_parse};
                     console.log(test)
                        $('#map').dropPin('showPins',{
                           cursor: 'crosshair',
                           pinclass: 'qtipinfo',
                           pin: '../../img/tag-solid.svg',
                           pinDataSet: {"markers":producto_parse}
                        });

                        $("#publicacion_nombre").val(nombre_public);
                        $("#publicacion_descripcion").val(descr_public);
                        $("#publicacion_categoria").val(nombre_public);

                        $("#img-subir-pins").hide();
                        $(".img-pines-amapear").attr("src",foto_src);
                        $("#map").css("width","700px");
                        $("#map").css("margin","auto");//para que este centrado
                        $("#eliminar-img-flotante").show();
                        $("#anadir-productos-btn").show();


                        
                     $("#buscador-titulo-input").keyup(function(){
                        activarBuscador($(this));
                     });


                  }
                  var select = document.getElementById('publicacion_categoria');
                  var option;
                  var cat_selected = jsonData.publicaciones[0].id_publicacion_categoria || 0;

                  for (var i=0; i<select.options.length; i++) {
                     option = select.options[i];

                     if (option.value == cat_selected) {
                        option.setAttribute('selected', true);
                     } 
                  }
               }else{
                  alert("ERROR: no se ha encontrado la publicacion")
               }
         });
      </script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script> -->
</body></html>
