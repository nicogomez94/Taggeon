<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@splidejs/splide@latest/dist/css/splide.min.css">

<!-- <div class="overlay-prod"></div> -->
<div class="row">
   <div class="container col-lg-8 col-md-12 col-sm-12 col-12" id="contenedor-form-subir" >
      <h1>Editar Publicacion</h1>
      <hr>
      <form id="editar-publicacion-form">
         <input type="hidden" name="accion" value="editar">
         
         <div id="output-container">
            <div class="popup-prod-overlay">
               <div id="popup-prod-cont">
                  <div class="filtros">
                     <input id="buscador-titulo-input" class="busq-prod-subir-public" type="text" name="prod_search_seller" placeholder="Busque el producto en la lista">
                     <i class="fas fa-times-circle limpiar-buscador" style="display: none;"></i>
                     <br>
                     <div id="salir-popup"><a href="javascript:void(0)"><i class="fas fa-times"></i></a></div>
                  </div>
                  <div class="popup-producto">
                     <div class="splide splide__prod_public">
                        <div class="splide__track">
                           <ul class="splide__list"></ul>
                        </div>
                     </div>
                     <div class="msj-no-result"></div>
                  </div>
               </div>
            </div>
            <div class="contenedor-content">
               <div class="click-protector-cont"></div>
               <!-- va solo en el editar -->
               <div id="map">
                  <img id="img-pines-amapear" src="">
               </div>
            </div>

            <!-- <div class="toggle-aspect-ratio">
               <div class="text-center">Elija un Tama&ntilde;o:</div>
               <div>
                  <label for="f-option" class="l-radio" data-aspect="1.77777">
                     <input type="radio" id="f-option" name="aspect-ratio" tabindex="1" >
                     <span>Horizontal (16:9)</span>
                  </label>
                  <label for="s-option" class="l-radio" data-aspect="1.33333">
                     <input type="radio" id="s-option" name="aspect-ratio" tabindex="2">
                     <span>Vertical (4:3)</span>
                  </label>
                  <label for="t-option" class="l-radio" data-aspect="1">
                     <input type="radio" id="t-option" name="aspect-ratio" tabindex="3">
                     <span>Cuadrado (1:1)</span>
                  </label>
               </div>
            </div> -->
            <div class="anadir-productos">
               <hr>
               <a href="javascript:void(0)" id="anadir-productos-btn" class="btn btn-warning" onclick="btnAnadirTag()">AÃ±adir productos</a>
               <a href="javascript:void(0)" id="cropear-btn" class="btn btn-warning disabled">Terminar Ajuste</a>
               <a href="javascript:void(0)" id="terminar-productos-btn" class="btn btn-warning">Terminar Edicion</a>
               <!-- <a href="javascript:void(0)" id="limpiar-productos-btn" class="btn btn-warning">Limpiar Pines</a> -->
            </div>
         </div>

         <div id="col-foto-upload">
            <div class="row">
               <div class="col-lg-12">
                  <div class="group">      
                     <input type="text" name="publicacion_nombre" id="titulo-publicacion" required>
                     <span class="highlight"></span>
                     <span class="bar"></span>
                     <label class="label-text-subir-publicacion">Nombre del publicacion</label>
                  </div>
               </div>
            </div>
            <div class="row">
               <div class="col-lg-12">
                  <p class="label-descr">Descripcion de la publicacion</p>
                  <textarea type="text" name="publicacion_descripcion" id="descr-publicacion" required></textarea>
               </div>
            </div>
            <div class="row">
               <div class="col-lg-3">
                  <div id="sels_cat_prod" class="col-lg-12">
                     <div class="tipo-escena-container">
                        <hr>
                        <h5>Tipo de escena:</h5>
                        <input id="radio1" value="Arquitectura" name="escena_sel" type="radio"><label for="radio1" onclick="getEscenas('Arquitectura')">Arquitectura</label>
                        <input id="radio2" value="Indumentaria" name="escena_sel" type="radio"><label for="radio2" onclick="getEscenas('Indumentaria')">Indumentaria</label>
                     </div>
                     <div class="tipo-espacio-container">
                        <hr>
                        <h5>1. Seleccione el tipo de espacio:</h5>
                        <select name="subescena1" id="sel_tipo_esp" onchange="getSubEscena(this.value)">
                           <option value="" selected disabled hidden required>Elija el tipo de espacio</option>
                        </select>
                        <h5 class="label-hidden"><hr>2. Seleccione el tipo de parametro:</h5>
                        <div class="text-left" id="subescenas-container" style="display: none;"></div>
                     </div>
                  </div>
               </div>
            </div>
            <br><hr>
            
            <div>
               <div class="row">
                  <div class="col-lg-4">
                     <br>
                     <input type="submit" class="btn btn-warning" value="Guardar publicacion">
                  </div>
               </div>
            </div>
         </div>
      </form>
   </div>
</div>

<script>
   var jsonData = {json};
</script>
   
<script>
$(document).ready(function(){
   var sizePublic = jsonData.publicaciones.length;
   var id_public = jsonData.publicaciones[0].id || 0;
   var id_public_cat = jsonData.publicaciones[0].id_publicacion_categoria || "";
   var nombre_public = jsonData.publicaciones[0].publicacion_nombre || "";
   var descr_public = jsonData.publicaciones[0].publicacion_descripcion || "";
   var tipo_espacio = jsonData.publicaciones[0].subescena1 || "";
   var subescena_name = jsonData.publicaciones[0].escena_sel || "";
   var subescena_json = JSON.parse(jsonData.publicaciones[0].subescena_json) || "";
   var descr_public = jsonData.publicaciones[0].publicacion_descripcion || "";
   var imagen_id = jsonData.publicaciones[0].foto || "";
   var foto_src = '/publicaciones_img/'+imagen_id+'.png' || "";
   var tags = jsonData.publicaciones[0].pid || "";
   var producto_parse = JSON.parse(tags);
   var map = $("#map");
   var img_mapear = $("#img-pines-amapear");
   

   if(sizePublic>0){

         //dibujo los selects
         getSubEditarPublic(subescena_name,tipo_espacio,subescena_json)

         //leo los parametros
         /*subescena_json.forEach(el => {
            let value_id = el.value.split("-")[0];
            getParamTipoEspacio(value_id,"esc_"+value_id);
         });*/

         //vals de inputs
         document.querySelector("#titulo-publicacion").value = nombre_public;
         document.querySelector("#descr-publicacion").value = descr_public;

         $('#map').dropPin('dropMulti',{
            cursor: 'crosshair',
            pinclass: 'qtipinfo',
            pin: '../../plugins/dropPin-master/dropPin/dot-circle-solid.svg',
            pinDataSet: {"markers":producto_parse}
         });
      
         //seteo la imagen
         img_mapear.attr("src",foto_src);

   }else{
      alert("ERROR: no se ha encontrado la publicacion")
   }


   //recorro los parametros seleccionados
   /*for(var i=0; i<subescena_json.length; i++) {
      let value_id = subescena_json[i].value.split("-")[0];
      console.log(value_id)
      getParamTipoEspacio(value_id,"esc_"+value_id);
   }*/

});

function getSubEditarPublic(esc_main,tipo_espacio,subescena_json){

   if(esc_main=="Arquitectura"){
      getEscenas("Arquitectura")
      //hacer una funcion que vaya a buscar la lista de options de ese select y que seleccione el especifico
      //y que por parametro le pase a que select tiene que dispararle y cual seleccionar despues
      getSubEscena(tipo_espacio,subescena_json)
      //$("#subescenas-container").find("[name='ESTILO']")
   }else{
      getEscenas('Indumentaria')
   }

}
</script>
