<div class="overlay-loading"></div>

<div class="container contenedor-ampliar-public">

   <div class="container">
      <div class="row">
         <div class="col-lg-8">
            <div class="row insert-public">
               
            </div>
         </div>
         <div class="col-lg-4">
            <div class="fixed-col-der">
               <div class="header-public header-public-fixed">
                  <span class="img-perfil-public">
                     <img src="../../img/furrr.jpg" alt="">
                  </span>
                  <span class="title-public">NombreTest</span>
               </div>
               <hr>
               <div>
                  <h5>Sugerencias para ti</h5>
                  <br>
                  <div class="media media-sugeridos">
                     <img class="mr-3 test-suggest" src="../../img/furrr.jpg" alt="Generic placeholder image">
                     <div class="media-body">
                       <h6 class="mt-0">Ricardo Alberto</h6>
                       <span>Sugerido porque te gusta</span>
                     </div>
                   </div>
                   <div class="media media-sugeridos">
                     <img class="mr-3 test-suggest" src="../../img/furrr.jpg" alt="Generic placeholder image">
                     <div class="media-body">
                       <h6 class="mt-0">Caro Iaco</h6>
                       <span>Sugerido porque te gusta</span>
                     </div>
                   </div>
                   <div class="media media-sugeridos">
                     <img class="mr-3 test-suggest" src="../../img/furrr.jpg" alt="Generic placeholder image">
                     <div class="media-body">
                       <h6 class="mt-0">Gonzalo Delafare</h6>
                       <span>Sugerido porque te gusta ...</span>
                     </div>
                   </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   
      
</div>


<script>
   var jsonData = {json};
   /*var jsonDataProd = {
         "productos":[{"0":"60","id":"60","1":"lisoform1","titulo":"lisoform1","2":"1","id_rubro":"1","3":"dfgs","marca":"dfgs","4":"8","precio":"8","5":"0","envio":"0","6":"1","garantia":"1","7":"ggf","descr_producto":"ggf","8":"color-rojo","color":"color-rojo","9":"34","stock":"34","10":"181","foto":"181"},{"0":"67","id":"67","1":"test","titulo":"test","2":"1","id_rubro":"1","3":"sdfsd","marca":"sdfsd","4":"2312","precio":"2312","5":"1","envio":"1","6":"0","garantia":"0","7":"fdsf","descr_producto":"fdsf","8":"color-rojo","color":"color-rojo","9":"23","stock":"23","10":"175","foto":"175"},{"0":"71","id":"71","1":"bmw","titulo":"bmw","2":"1","id_rubro":"1","3":"bmw","marca":"bmw","4":"123","precio":"123","5":"1","envio":"1","6":"0","garantia":"0","7":"bmnz","descr_producto":"bmnz","8":"color-rojo","color":"color-rojo","9":"1","stock":"1","10":"199","foto":"199"},{"0":"75","id":"75","1":"dfgfg","titulo":"dfgfg","2":"1","id_rubro":"1","3":"dsfsd","marca":"dsfsd","4":"23","precio":"23","5":"0","envio":"0","6":"1","garantia":"1","7":"fsdf","descr_producto":"fsdf","8":"color-rojo","color":"color-rojo","9":"1","stock":"1","10":"217","foto":"217"}]
      }*/
</script>


   <script src="js/jquery-3.5.1.js"></script>
   <!-- <script type="text/javascript" src="../../js/slick/slick/slick.min.js"></script> -->
   <script src="bootstrap-4.5.2-dist/js/bootstrap.min.js"></script>
   <!-- <script src="js/popper.js"></script> -->
   <script src="js/func.js?time=091120-1404"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script> -->
<script>
$(document).ready(function(){

var sizePublic = jsonData.publicaciones.length;

if(sizePublic>0){
   for(var i=0; i<sizePublic; i++){
      
      var id_public = jsonData.publicaciones[i].id;
      var id_public_cat = jsonData.publicaciones[i].id_publicacion_categoria;
      var nombre_public = jsonData.publicaciones[i].publicacion_nombre;
      var descr_public = jsonData.publicaciones[i].publicacion_descripcion;
      var imagen_id = jsonData.publicaciones[i].foto;
      var producto = jsonData.publicaciones[i].pid;
      
      var foto_src = '/publicaciones_img/'+imagen_id;

   
      var html_public = '<div class="public-ampliar public-actual test2">'+
                           '<div class="header-public">'+
                              '<span class="img-perfil-public">'+
                                 '<img src="" alt="img-perfil">'+
                              '</span>'+
                              '<span class="title-public"></span>'+
                              '<span class="opciones-public"><i class="fas fa-cog"></i></span>'+
                           '</div>'+
                        '<div class="bodyimg-public-container">'+
                           //'<div><img src="../../img/arrrrte.jpg" alt=""></div>'+
                              '<img class="imagen-public-'+imagen_id+'" src="" alt="">'+
                              '<div class="tag-container tag-container-'+i+'">'+
                        '</div>'+
                        '<div class="info-public">'+
                           '<div class="social-public">'+
                                 '<span><i class="fas fa-heart"></i></span>'+
                                 '<span><i class="fas fa-comment-dots"></i></span>'+
                                 '<span><i class="fas fa-paper-plane"></i></span>'+
                           '</div>'+
                        '<div class="datos-public">'+
                           '<div class="info-titulo-public">'+nombre_public+'</div>'+
                           '<div class="info-tipo-public"><a href="#">Arte</a> | <a href="#">Diseño</a> | <a href="#">Ambientes</a></div>'+
                           '<div class="info-descr-public">'+descr_public+'</div>'+
                        '</div>'+
                           '<hr>'+
                        '<div class="productos-public">'+
                           '<div class="productos-titulo-public">Productos en esta publicacion:</div><br>'+
                              '<div class="productos-titulo-public-gallery productos-titulo-public-gallery-'+i+'">'+
                                 //'<img data-toggle="modal" data-target="#modal-producto-1" src="../../img/bch05-bacha-de-apoyar-cuadrada-370x370x130-copia (1).jpg" style="width: 100px; height: 100px; margin-right: 5px 10px 5px 5px; cursor: pointer;" alt="">'+
                              '</div>'+
                           '</div>'+
                        '</div>'+
                     '</div>'
                        
      $(".insert-public").append(html_public);

      

      //imgperfil sacada del menu top
      var img_perfil = $(".img-perfil-usuario-drop").attr("src");
      $(".img-perfil-public img").attr("src", img_perfil);
      $(".test-suggest").attr("src", img_perfil);

      //nombre perfil
      var nombre_perfil = $(".user-name-perfil").text();
      $(".title-public").html(nombre_perfil);
      
      //imagen principal de public
      var rawFile = new XMLHttpRequest();
      rawFile.open("GET", foto_src, false);
      rawFile.onreadystatechange = function ()
      {
         if(rawFile.readyState === 4)
         {
               if(rawFile.status === 200 || rawFile.status == 0)
               {
                  var response_error = "<h1>P&aacute;gina no encontrada.</h1><p>P&aacute;gina no encontrada.</p>";
                  var str_base64 = rawFile.responseText;
                  
                  $(".imagen-public-"+imagen_id).attr("src", str_base64);
               
               }
         }
      }
      rawFile.send(null);
      //

      ///DIBUJO PINES
      var producto_parse = JSON.parse(producto);
      var producto_parse_size = producto_parse.length;
      // console.log(producto_parse)
      // console.log(producto_parse_size)
      //cuando vuelve, vuevle a ser 0. --ACA ESTA EL PROBLEM
      for(var x=0; x<producto_parse_size; x++){
         var id_prod = producto_parse[x].name;
         var coords = producto_parse[x].value;
         var ycoord = coords.split("-")[0];
         var xcoord = coords.split("-")[1];
         //console.log(id_prod)
         //console.log(coords)
         //console.log("---")
         //console.log("para el prod "+x+"ycoord"+ycoord)
         //console.log("para el prod "+x+"xcoord"+xcoord)

         //checkeo si es el mismo id de tag y prod
         var arr = jsonData.productos;
         var obj = arr.find(o => o.id === id_prod);

         if(id_prod == obj.id){

            //le saco el index el producto correspondiente
            var arr2 = jsonData.productos;
            var index = arr2.findIndex(o => o.id === id_prod);
            //var test = Object.values(jsonData.productos)[x];

            var nombre_prod = jsonData.productos[index].titulo;
            var precio_prod = jsonData.productos[index].precio;
            var marca_prod = jsonData.productos[index].marca;
            var color_prod = jsonData.productos[index].color;
            var descr_prod = jsonData.productos[index].descr_producto;
            var id_prod_json = jsonData.productos[index].id;
            var stock_prod = jsonData.productos[index].stock;
            var foto_prod = jsonData.productos[index].foto;
            var id_cat = jsonData.categoria[index].id;
            var nombre_completo = jsonData.nombre+""+jsonData.apellido;

                 var modal_html =  
                  '<div class="modal fade" id="modal-producto-'+id_prod+'" tabindex="-1" role="dialog" aria-labelledby="modal-producto-title" aria-hidden="true">'+
                  '<div class="modal-dialog modal-dialog-centered modal-lg" role="document">'+
                  '<div class="modal-content">'+
                  '<!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close"></button> -->'+
                  '<div class="modal-body">'+
                  '<div class="row">'+
                  '<div class="col-lg-7">'+
                     '<div><img style="width: 100%;" src="'+imagen_id+'" alt=""></div>'+
                  '<hr>'+
                  '<div>'+
                  '<table class="tg" style="table-layout: fixed; width: 282px">'+
                  '<colgroup>'+
                  '<col style="width: 153px">'+
                  '<col style="width: 129px">'+
                  '</colgroup>'+
                  '<tbody>'+
                  '<tr>'+
                     '<td class="tg-9f3l">ID Producto</td>'+
                     '<td class="tg-wo29">'+id_prod_json+'</td>'+
                     '</tr>'+
                     '<tr>'+
                     '<td class="tg-9f3l">Marca</td>'+
                     '<td class="tg-wo29">'+marca_prod+'</td>'+
                     '</tr>'+
                     '<tr>'+
                     '<td class="tg-9f3l">Color</td>'+
                     '<td class="tg-wo29">'+color_prod+'</td>'+
                     '</tr>'+
                     '<tr>'+
                     '<td class="tg-9f3l">Categoria</td>'+
                     '<td class="tg-wo29">'+id_cat+'</td>'+
                     '</tr>'+
                     '<tr>'+
                     '<td class="tg-9f3l">Rubro</td>'+
                     '<td class="tg-z6p2">'+id_cat+'</td>'+//hardcodeado
                  '</tr>'+
                  '</tbody>'+
                  '</table>'+
                  '</div></div>'+
                  '<div class="col-lg-5 col-datos-producto">'+
                  '<div>'+
                     '<h2>'+nombre_prod+'</h2>'+
                     '<p style="font-size: 0.8em; color: grey; font-style: italic">Por: '+nombre_completo+'</p>'+
                  '</div>'+
                  '<hr>'+
                  '<div>'+
                  '<div class="precio-producto-modal"><span>'+precio_prod+'</span></div>'+
                  '<div class="shipment-modal-producto">'+
                  '<i class="fas fa-truck-loading"></i> Shipment dentro de las 5 dias habiles'+//hardcodeado
                  '</div>'+
                  '<hr>'+
                  '<div class="stock-boton-modal">'+
                  '<span>'+
                  'Cantidad&nbsp;'+
                  '<select name="" id="">'+
                  '<option value="1">1</option>'+//hardcodeado
                  '</select>'+
                  '</span>&nbsp;'+
                  '<span><a href="#" class="btn btn-warning">Añadir a Carrito</a></span>'+
                  '</div>'+
                  '</div>'+
                  '<hr>'+
                  '<div class="descripcion-modal-producto">'+
                  '<strong>Descripcion:</strong>'+
                  '<div>'+descr_prod+'</div>'+
                  '</div>'+
                  '<hr>'+
                  ''+
                  ''+
                  '</div>'+
                  '</div>'+
                  '</div>'+
                  '</div>'+
                  '</div>'+
                  '</div>';

                  $("body").append(modal_html)

                  ////////////////////////////////IMGPROD
                  /*var foto_prod_src = '/productos_img/'+foto_prod;

                  var rawFileProd = new XMLHttpRequest();
                  rawFileProd.open("GET", foto_prod_src, false);
                  rawFileProd.onreadystatechange = function ()
                  {
                     if(rawFileProd.readyState === 4)
                     {
                        if(rawFileProd.status === 200 || rawFileProd.status == 0)
                        {
                           var str_base64_prod = rawFile.responseText;
                           var prod_gallery = '<img src="'+str_base64_prod+'">';
                           $(".productos-titulo-public-gallery-"+index).append(prod_gallery);
                        }
                     }
                  }
                  rawFileProd.send(null);*/
                  /*var foto_prod_src = '/productos_img/'+foto_prod;
                  var rawFileProd = new XMLHttpRequest();
                  rawFileProd.open("GET", foto_prod_src, false);
                  rawFileProd.onreadystatechange = function ()
                  {
                     console.log("andetro1")
                     if(rawFileProd.readyState === 4)
                     {
                        console.log("andetro2")
                        if(rawFileProd.status === 200 || rawFileProd.status == 0)
                        {
                           console.log("andetroi raawwaaw")
                           var str_base64_prod = rawFileProd.responseText;
                           console.log(rawFileProd.responseText)
                           
                           var prod_gallery = '<img src="'+str_base64_prod+'">';
                           console.log(prod_gallery)
                           $(".productos-titulo-public-gallery-0").append(prod_gallery);
                        }
                     }
                  }
                  rawFileProd.send(null)*/
                  ////////////////////////////////IMGPROD
                  /*var prod_gallery
                  $(".productos-titulo-public-gallery-"+i).append(productos_gallery)*/

         }//fin prod
         var tag_html = '<div class="tagg" style="top:'+ycoord+'; left: '+xcoord+'">'+
                        '<span><i data-toggle="modal" data-target="#modal-producto-'+id_prod+'" class="fas fa-tags"></i></span></div>';
                  $(".tag-container-"+i).append(tag_html);
         
         
      }

   }
}

   var hardcodeado_img = '<img src="/productos_img/sdfs.jpg">'
   $(".productos-titulo-public-gallery").append(hardcodeado_img)

});
</script>
    
</body></html>
