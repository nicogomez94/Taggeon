<div class="overlay-loading"></div>

   <div class="container" id="contenedor-form-subir">
      <br><br>
      <h1>Editar Producto</h1>
      <hr>
      <form id="producto-form">
         <input type="hidden" name="accion" value="editar" autocomplete="on">
	      <input type="hidden" name="id" value="{id}" autocomplete="on">
         
         <div id="col-foto-upload">
               <p class="label-descr">Seleccione al menos una foto para el producto. <span class="info" style="font-size: 0.6em;"><i class="fas fa-question-circle"></i></span></p>
               <div class="row">
                  <div id="contenedor-subir-foto" class="img-subir">
                     <div id="uploads"></div>
                  </div>
               </div>

               <!-- principales -->
               <div class="campos-subir-prod">      
                  <input type="text" name="titulo" id="titulo-producto" placeholder="Nombre del producto" required>
                  <!-- <label class="label-text-subir-producto">Nombre del producto</label> -->
               </div>
               <div class="campos-subir-prod">      
                  <input type="number" name="precio" id="precio-producto" placeholder="Precio" required>
                  <!-- <label class="label-text-subir-producto">Precio</label> -->
               </div>
               <div class="campos-subir-prod"> 
                  <!-- <p class="label-descr">Descripcion del producto</p> -->
                  <textarea type="text" name="descr_producto" id="descr-producto" placeholder="Ingrese una descripcion del producuto" required></textarea>
               </div>
               <!-- /principales -->

               <hr>

               <!-- secundarios -->
               <div class="row">
                  <div class="col-lg-6">
                     <div class="campos-subir-prod">      
                        <input type="text" name="marca" id="marca-producto" required placeholder="Marca">
                     </div>
                  </div>
                  <div class="col-lg-6">
                     <div class="campos-subir-prod">      
                        <input type="number" name="stock" id="stock-producto" required  placeholder="Stock">
                     </div>
                  </div>
               </div>
               <div class="row" style="margin-top: 20px;">
                  <div id="sels_cat_prod" class="col-lg-6 col-md-6 col-sm-12 col-12">
                     <select class="showCat" name="categoria" id="categoria-producto" onchange="getSubCat(this.value,'#categoria-producto','#categoria-producto2')">
                        <option value="" selected disabled hidden required>Elija una categor&iacute;a</option>
                     </select>
                     <select name="subcategoria1" id="categoria-producto2" onchange="getSubCat(this.value,'#categoria-producto2','#categoria-producto3')">
                        <option value="" selected disabled hidden required>Elija una subcategor&iacute;a</option>
                     </select>
                     <select name="subcategoria2" id="categoria-producto3" onchange="getSubCat(this.value,'#categoria-producto3','#categoria-producto4')">
                        <option value="" selected disabled hidden required>Elija otra subcategor&iacute;a</option>
                     </select>
                     <select name="subcategoria3" id="categoria-producto4" onchange="getSubCat(this.value,'#categoria-producto4','#categoria-producto5')">
                        <option value="" selected disabled hidden required>Elija otra subcategor&iacute;a</option>
                     </select>
                  </div>
                  <div id="sels_cat_prod" class="col-lg-6 col-md-6 col-sm-12 col-12">
                     
                  </div>
               </div>
               <div class="campos-subir-prod"> 
                  <select name="color" id="color">
                     <option value="" selected disabled hidden required>Elija un color</option>
                     <option value="color-negro">Negro</option>
                     <option value="color-azul">Azul</option>
                     <option value="color-rojo">Rojo</option>
                     <option value="color-verde">Verde</option>
                     <option value="color-amarillo">Amarillo</option>
                  </select>
               </div>
               <div class="campos-subir-prod"> 
                  <select name="envio" id="envio-producto">
                     <option value="" selected disabled hidden required>Env&iacute;o</option>
                     <option value="1">Si</option>
                     <option value="0">No</option>
                  </select>
               </div>
               <div class="campos-subir-prod">
                  <select name="garantia" id="garantia-producto">
                     <option value="" selected disabled hidden required>Garant&iacute;a</option>
                     <option value="1">Si</option>
                     <option value="0">No</option>
                  </select>
               </div>
               <!--  -->
               <input type="hidden" name="rubro" value="1">

            <!-- /secundarios -->

            <div>
               <div class="row">
                  <div class="col-lg-4 mt-5">
                     <input type="submit" class="btn btn-warning" value="Guardar Producto">
                  </div>
               </div>
            </div>
         </div>

      </form>
   </div>

   <script>
      var jsonData = {json};
      
   </script>
   

   <script>
      $(document).ready(function(){
       
         uploadHBR.init({
               "target": "#uploads",
               "textNew": "A&ntilde;adir",
               "textTitle": "Haga click o draguee su imagen",
               "textTitleRemove": "Haga click para remover imagen"
         });
         $('#reset').click(function () {
               uploadHBR.reset('#uploads');
            });
            
         var sizeProductos = jsonData.productos.length || 0;
         var subcats_length = jsonData.productos[0] || [];
      
         //dibujo select de cats
         //primero prreguntar si existedibujarle valor por valoir a cada select
         for(var i=0; i<subcats_length; i++) {
            var cat_id = subcats[i].id;
            var cat_nombre = subcats[i].nombre;
            var targetHtml = $(target);

            var cat_select_html = 
            '<option value="'+cat_id+'">'+cat_nombre+'</option>';

            targetHtml.append(cat_select_html)
            targetHtml.addClass("showCat");
         }
         
         for(var i=0; i<sizeProductos; i++){
            
            var id_prod = jsonData.productos[i].id || 0;
            var nombre_prod = jsonData.productos[i].titulo || "";
            var marca_prod = jsonData.productos[i].marca || "";
            var precio_prod = jsonData.productos[i].precio || 0;
            var envio_prod = jsonData.productos[i].envio || "";
            var garantia_prod = jsonData.productos[i].garantia || "";
            var descr_prod = jsonData.productos[i].descr_producto || "";
            var foto_prod_editar = jsonData.productos[i].foto || "";
            var color_prod = jsonData.productos[i].color || "";
            var nombre_cat = jsonData.categoria[i].nombre || "";
            var stock_prod = jsonData.productos[i].stock || 0;
            var id_cat = jsonData.categoria[i].id || 0;
            var fotosArray = foto_prod_editar.split(",") || [];
            var base = $("#base64_"+i);
                  
            $("#titulo-producto").val(nombre_prod);
            $("#precio-producto").val(precio_prod);
            $("#stock-producto").val(stock_prod);
            $("#color").val(color_prod);
            $("#descr-producto").val(descr_prod);
            $("#marca-producto").val(marca_prod);
            $("#envio-producto").val(envio_prod);
            $("#garantia-producto").val(garantia_prod);
         
            for(var i=0; i<fotosArray.length; i++){
   
               var foto_src = '/productos_img/'+fotosArray[i]+'.png' || 0;
               var img = $("#prev_"+i).find(".img-responsive");

               img.attr("onerror","this.src=\'/imagen_perfil/generica_prod.jpg\'");
               //img.attr("onload","$(this).parent().parent().find('.new').addClass('hidden')");
               img.attr("src",foto_src);
               img.parent().removeClass("hidden");
               
               var html_cat = '<option class="option-cat" value="'+id_cat+'" selected>'+nombre_cat+'</option>';
               $("#categoria-producto").append(html_cat);
               
               //paso imagenes existentes a base64
               toDataURL(
                  foto_src,
                  function(dataUrl) {
                     console.log(base)
                     base.val(dataUrl);
                  }
               )
                  
            }
            
         }
         

   });
   </script>